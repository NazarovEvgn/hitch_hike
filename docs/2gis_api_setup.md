# Настройка 2GIS API для клиентского приложения

## Почему нужен API ключ?

Клиентское приложение ХичХайк использует **2GIS MapGL** для отображения интерактивной карты с маркерами автосервисов. Для работы карты требуется API ключ от 2GIS.

**Без ключа:** Карта загружает бежевый фон, но не отображает тайлы и выдает ошибку 400.

---

## Как получить API ключ

### Вариант 1: Демо-ключ (Бесплатно для тестирования)

1. **Регистрация:**
   - Откройте https://dev.2gis.ru
   - Нажмите "Войти" / "Зарегистрироваться"
   - Заполните форму регистрации

2. **Создание ключа:**
   - После входа перейдите в **Platform Manager**
   - Нажмите "Создать проект" или выберите существующий
   - Выберите **"Создать демо-ключ"**
   - Скопируйте сгенерированный ключ

3. **Ограничения демо-ключа:**
   - Ограниченное количество запросов в день
   - Подходит для разработки и тестирования
   - Может содержать ватермарки

### Вариант 2: Студенческий/Некоммерческий доступ

При создании ключа выберите категорию:
- **"Студенческий проект"**
- **"Некоммерческий проект"**

Это дает расширенные лимиты и более длительный бесплатный период.

### Вариант 3: Коммерческая подписка

Для production приложения потребуется:
- Связаться с отделом продаж 2GIS
- Оформить коммерческую подписку (~1000-3000 руб/мес в зависимости от трафика)

---

## Установка ключа в проект

### Шаг 1: Откройте файл `.env`

```bash
# Путь к файлу
client-app/.env
```

### Шаг 2: Замените placeholder на реальный ключ

```env
# ДО (не работает)
DGIS_API_KEY=your-2gis-api-key-here

# ПОСЛЕ (ваш настоящий ключ)
DGIS_API_KEY=rurfje00000000000000000000001234567890abcd
```

### Шаг 3: Перезапустите dev-сервер

```bash
# Остановите текущий сервер (Ctrl+C)
# Затем запустите снова:
cd client-app
npm run dev
```

**Важно:** Изменения в `.env` файле требуют полного перезапуска dev-сервера (hot-reload не работает для переменных окружения).

---

## Проверка работы

После установки ключа и перезапуска сервера:

1. Откройте http://localhost:9003 (или порт, указанный при запуске)
2. Карта должна загрузиться полностью с улицами Тюмени
3. В консоли браузера (F12) должно быть сообщение: `"2GIS Map initialized successfully"`
4. Не должно быть ошибок типа `"Failed to load resource: keys.api.2gis.com"` с кодом 400

---

## Troubleshooting (Решение проблем)

### Ошибка: "Failed to load resource: keys.api.2gis.com - 400"

**Причина:** Неправильный или отсутствующий API ключ.

**Решение:**
1. Проверьте, что в `client-app/.env` указан реальный ключ (не placeholder)
2. Убедитесь, что ключ скопирован полностью без пробелов
3. Перезапустите dev-сервер

### Ошибка: "Network error" при загрузке тайлов

**Причина:** Проблемы с интернет-соединением или ключ истек.

**Решение:**
1. Проверьте подключение к интернету
2. Проверьте, что демо-ключ не истек (срок действия можно посмотреть в Platform Manager)
3. Создайте новый демо-ключ

### Карта показывает только бежевый фон

**Причина:** API ключ не подгрузился из `.env` файла.

**Решение:**
1. Убедитесь, что файл называется именно `.env` (с точкой в начале)
2. Проверьте, что переменная называется `DGIS_API_KEY` (регистр важен)
3. Полностью перезапустите dev-сервер

---

## Полезные ссылки

- **Регистрация и получение ключа:** https://dev.2gis.ru
- **Документация MapGL JS API:** https://docs.2gis.com/en/mapgl/overview
- **Примеры использования:** https://docs.2gis.com/en/mapgl/examples
- **npm пакет:** https://www.npmjs.com/package/@2gis/mapgl
- **Getting Started:** https://docs.2gis.com/en/mapgl/start/first-steps

---

**Дата создания:** 30 ноября 2025
**Статус:** Phase 4 - Client PWA Development
